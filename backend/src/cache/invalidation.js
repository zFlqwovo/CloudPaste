import cacheBus, { CACHE_EVENTS } from "./cacheBus.js";

const emit = (payload) => {
  cacheBus.emit(CACHE_EVENTS.INVALIDATE, payload);
};

export const invalidateFsCache = ({
  mountId = null,
  paths = [],
  s3ConfigId = null,
  reason = "manual",
  bumpMountsVersion = false,
  db = null,
}) => {
  if (!mountId && !s3ConfigId && !paths.length) {
    return;
  }
  emit({ target: "fs", mountId, paths, s3ConfigId, reason, bumpMountsVersion, db });
};

export const invalidatePreviewCache = ({ db = null, reason = "manual" } = {}) => {
  emit({ target: "preview", db, reason });
};

export const invalidateAllCaches = ({ reason = "manual" } = {}) => {
  emit({ invalidateAll: true, reason });
};
